<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>e108 Bangs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      background-color: #f7f7f7;
    }
    .container { 
      text-align: center; 
      max-width: 600px; 
      padding: 20px; 
    }
    h1 { 
      font-size: 3rem; 
      margin-bottom: 10px; 
      font-weight: 500; 
      color: #303030; 
    }
    p { 
      font-size: 1rem; 
      margin-bottom: 20px; 
      line-height: 1.5; 
    }
    .url-container { 
      display: flex; 
      margin-top: 15px; 
      border-radius: 4px; 
      overflow: hidden; 
    }
    input {
      flex: 1; 
      padding: 10px; 
      border: none; 
      outline: none;
      font-size: 14px; 
      background-color: #f5f5f5; 
      border-radius: 3px;
      border: 0.5px solid #ddd;
    }
    .copy-button {
      background-color: #f7f7f7; 
      border: none; 
      border-radius: 5px;
      padding: 8px 12px; 
      cursor: pointer; 
      margin-left: 5px;
      transition: all 0.3ms;
    }
    .copy-button:hover { 
      transition: all 0.3s; 
      background-color: #ebebeb; 
    }
    .footer {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.75rem;
      color: #666;
    }
    a { 
      color: #666; 
      text-decoration: none; 
      margin: 0 5px; 
      transition: all 0.3ms; 
    }
    a:hover { 
      transition: all 0.3ms; 
      text-decoration: underline; 
    }
    .link { 
      transition: all 0.3ms; 
      color: #858585; 
      text-decoration: underline; 
      cursor: pointer; 
    }
  </style>
</head>
<body>
  <div id="app"></div>
  <script type="module">
    document.addEventListener("DOMContentLoaded", async () => {
      const { bangs } = await import('./bang.js');
      const LS_DEFAULT_BANG = localStorage.getItem("default-bang") || "g";
      const defaultBang = bangs.find(b => b.t === LS_DEFAULT_BANG) || bangs[0];
      function getBangRedirectUrl() {
        const urlParams = new URLSearchParams(window.location.search);
        const query = urlParams.get("q")?.trim() || "";
        if (!query) return null;
        const match = query.match(/!(\S+)/i);
        const bangCandidate = match ? match[1].toLowerCase() : "";
        const selectedBang = bangs.find(b => b.t === bangCandidate) || defaultBang;
        const cleanQuery = query.replace(/!\S+\s*/i, "").trim();
        const searchUrl = selectedBang.u.replace("{{{s}}}", encodeURIComponent(cleanQuery).replace(/%2F/g, "/"));
        return searchUrl;
      }
      function doRedirect() {
        const redirectUrl = getBangRedirectUrl();
        if (redirectUrl) {
          window.location.replace(redirectUrl);
        }
      }
      function renderDefaultPage() {
        const app = document.getElementById("app");
        app.innerHTML = `
          <div class="container">
            <h1>e108 Bangs</h1>
            <p>
              DuckDuckGo's bang redirects are too slow. Add the following URL as a custom search engine to your browser. 
              Enables all of DuckDuckGo's <a class="link" href="https://duckduckgo.com/bangs" target="_blank">bangs</a>.
            </p>
            <div class="url-container">
              <input type="text" id="urlInput" value="https://bang.e108.dev/?q=%s" readonly>
              <button class="copy-button" id="copyButton">
                <svg id="copyIcon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                  <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"></path>
                </svg>
              </button>
            </div>
          </div>
          <div class="footer">
            <a href="https://e108.dev" target="_blank">e108.dev</a> • 
            <a href="https://github.com/Q2x38b" target="_blank">e108</a> • 
            <a href="https://github.com/Q2x38b/simplified-bangs" target="_blank">github</a>
          </div>
        `;
        const copyButton = document.getElementById("copyButton");
        const urlInput = document.getElementById("urlInput");
        const defaultIcon = `<svg id="copyIcon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"></path>
                              </svg>`;
        const checkIcon = `<svg id="copyIcon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <path d="M20 6L9 17l-5-5" />
                            </svg>`;
        copyButton.addEventListener("click", async () => {
          try {
            await navigator.clipboard.writeText(urlInput.value);
            copyButton.innerHTML = checkIcon;
            setTimeout(() => {
              copyButton.innerHTML = defaultIcon;
            }, 2000);
          } catch (err) {
            console.error("Failed to copy text: ", err);
          }
        });
      }
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.has("q") && urlParams.get("q").trim() !== "") {
        doRedirect();
      } else {
        renderDefaultPage();
      }
    });
  </script>
</body>
</html>
